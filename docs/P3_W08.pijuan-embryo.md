# Chimeric embryo 10X dataset



## Introduction

This performs an analysis of the pijuan2019singlcell dataset studying mouse gastrulation.
Here, we examine chimeric embryos at the E7.5 stage of development 
where Tomato-positive embryonic stem cells (ESCs) were injected into a wild-type blastocyst.

## Analysis code

### Data loading


```r
library(MouseGastrulationData)
sce.chimera <- WTChimeraData(samples=5:10)
sce.chimera
```

```
## class: SingleCellExperiment 
## dim: 29453 20935 
## metadata(0):
## assays(1): counts
## rownames(29453): ENSMUSG00000051951 ENSMUSG00000089699 ...
##   ENSMUSG00000095742 tomato-td
## rowData names(2): ENSEMBL SYMBOL
## colnames(20935): cell_9769 cell_9770 ... cell_30702 cell_30703
## colData names(10): cell barcode ... closest.cell doub.density
## reducedDimNames(2): pca.corrected.E7.5 pca.corrected.E8.5
## spikeNames(0):
## altExpNames(0):
```


```
##            used (Mb) gc trigger (Mb) max used (Mb)
## Ncells 5.91e+06  316   9.96e+06  532 9.96e+06  532
## Vcells 1.36e+08 1040   4.59e+08 3504 3.60e+08 2747
```

### Feature annotation


```r
library(scater)
rownames(sce.chimera) <- uniquifyFeatureNames(
    rowData(sce.chimera)$ENSEMBL, rowData(sce.chimera)$SYMBOL)
```

### Quality control

Quality control on the cells has already been performed by the authors, so we will not repeat it here.
We additionally remove cells that are labelled as stripped nuclei or doublets.


```r
drop <- sce.chimera$celltype.mapped %in% c("stripped", "Doublet")
sce.chimera <- sce.chimera[,!drop]
```

### Normalization

We use the pre-computed size factors in `sce.chimera`.


```r
sce.chimera <- logNormCounts(sce.chimera)

# TODO: put in multiBatchNorm() in here.
```

### Variance modelling

Retaining all genes with any positive biological component, to preserve as much signal as possible across many samples.


```r
library(scran)
dec <- modelGeneVar(sce.chimera, block=sce.chimera$sample)
chosen.hvgs <- dec$bio > 0
```

### Merging

We use a hierarchical merge to first merge together replicates with the same genotype, 
and then merge samples across different genotypes.


```r
library(batchelor)
merged <- correctExperiments(sce.chimera, 
    batch=sce.chimera$sample, 
    subset.row=chosen.hvgs,
    PARAM=FastMnnParam(
        merge.order=list(
            list(
                list(1, 3), # WT (3 replicates)
                5
            ),
            list(
                list(2, 4), # td-Tomato (3 replicates)
                6
            )
        )
    )
)
```

### Clustering


```r
g <- buildSNNGraph(merged, use.dimred="corrected")
clusters <- igraph::cluster_louvain(g)
merged$cluster <- factor(clusters$membership)
```

### Dimensionality reduction

We use an external algorithm to compute nearest neighbors for greater speed.


```r
merged <- runTSNE(merged, dimred="corrected", external_neighbors=TRUE)
merged <- runUMAP(merged, dimred="corrected", external_neighbors=TRUE)
```
