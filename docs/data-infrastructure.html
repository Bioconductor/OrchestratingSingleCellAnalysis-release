<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data Infrastructure | Orchestrating Single-Cell Analysis with Bioconductor</title>
  <meta name="description" content="Online companion to ‘Orchestrating Single-Cell Analysis with Bioconductor’ manuscript by the Bioconductor team." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data Infrastructure | Orchestrating Single-Cell Analysis with Bioconductor" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Online companion to ‘Orchestrating Single-Cell Analysis with Bioconductor’ manuscript by the Bioconductor team." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data Infrastructure | Orchestrating Single-Cell Analysis with Bioconductor" />
  
  <meta name="twitter:description" content="Online companion to ‘Orchestrating Single-Cell Analysis with Bioconductor’ manuscript by the Bioconductor team." />
  



<meta name="date" content="2019-06-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="beyond-r-basics.html">
<link rel="next" href="analytical-workflow-overview.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Orchestrating Single-Cell Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Preamble</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#preliminaries"><i class="fa fa-check"></i><b>1.1.1</b> Preliminaries</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#workflows"><i class="fa fa-check"></i><b>1.1.2</b> Workflows</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-you-wont-learn"><i class="fa fa-check"></i><b>1.2</b> What you won’t learn</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#who-we-wrote-this-for"><i class="fa fa-check"></i><b>1.3</b> Who we wrote this for</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-we-wrote-this"><i class="fa fa-check"></i><b>1.4</b> Why we wrote this</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html"><i class="fa fa-check"></i><b>2</b> Learning R and Bioconductor</a><ul>
<li class="chapter" data-level="2.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#the-benefits-of-r-and-bioconductor"><i class="fa fa-check"></i><b>2.1</b> The Benefits of R and Bioconductor</a></li>
<li class="chapter" data-level="2.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.2</b> Learning R Online</a></li>
<li class="chapter" data-level="2.3" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#running-r-locally"><i class="fa fa-check"></i><b>2.3</b> Running R Locally</a><ul>
<li class="chapter" data-level="2.3.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#installing-r-bioconductor-packages"><i class="fa fa-check"></i><b>2.3.2</b> Installing R &amp; Bioconductor Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#getting-help-in-and-out-of-r"><i class="fa fa-check"></i><b>2.4</b> Getting Help In (and Out) of R</a></li>
<li class="chapter" data-level="2.5" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-documentation"><i class="fa fa-check"></i><b>2.5</b> Bioconductor Help</a><ul>
<li class="chapter" data-level="2.5.1" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-packages"><i class="fa fa-check"></i><b>2.5.1</b> Bioconductor Packages</a></li>
<li class="chapter" data-level="2.5.2" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#biocviews"><i class="fa fa-check"></i><b>2.5.2</b> biocViews</a></li>
<li class="chapter" data-level="2.5.3" data-path="learning-r-and-more.html"><a href="learning-r-and-more.html#bioconductor-forums"><i class="fa fa-check"></i><b>2.5.3</b> Bioconductor Forums</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html"><i class="fa fa-check"></i><b>3</b> Beyond R Basics</a><ul>
<li class="chapter" data-level="3.1" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#becoming-an-r-expert"><i class="fa fa-check"></i><b>3.1</b> Becoming an R Expert</a></li>
<li class="chapter" data-level="3.2" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#becoming-a-bioconductor-developer"><i class="fa fa-check"></i><b>3.2</b> Becoming an R/Bioconductor Developer</a></li>
<li class="chapter" data-level="3.3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#nice-companions-for-r"><i class="fa fa-check"></i><b>3.3</b> Nice Companions for R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#shellbash"><i class="fa fa-check"></i><b>3.3.1</b> Shell/Bash</a></li>
<li class="chapter" data-level="3.3.2" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#git"><i class="fa fa-check"></i><b>3.3.2</b> Git</a></li>
<li class="chapter" data-level="3.3.3" data-path="beyond-r-basics.html"><a href="beyond-r-basics.html#other-languages"><i class="fa fa-check"></i><b>3.3.3</b> Other Languages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-infrastructure.html"><a href="data-infrastructure.html"><i class="fa fa-check"></i><b>4</b> Data Infrastructure</a><ul>
<li class="chapter" data-level="4.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#prerequisites"><i class="fa fa-check"></i><b>4.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#the-singlecellexperiment-class"><i class="fa fa-check"></i><b>4.2</b> The <em>SingleCellExperiment</em> Class</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-infrastructure.html"><a href="data-infrastructure.html#primary-data-the-assays-slot"><i class="fa fa-check"></i><b>4.2.1</b> Primary Data: The <code>assays</code> Slot</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-infrastructure.html"><a href="data-infrastructure.html#extending-the-assays-slot"><i class="fa fa-check"></i><b>4.2.2</b> Extending the <code>assays</code> Slot</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#column-metadata-coldata-slot"><i class="fa fa-check"></i><b>4.2.3</b> Column (Meta)Data: <code>colData</code> Slot</a></li>
<li class="chapter" data-level="4.2.4" data-path="data-infrastructure.html"><a href="data-infrastructure.html#feature-metadata-rowdatarowranges"><i class="fa fa-check"></i><b>4.2.4</b> Feature Metadata: <code>rowData</code>/<code>rowRanges</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="data-infrastructure.html"><a href="data-infrastructure.html#size-factors-slot-sizefactors"><i class="fa fa-check"></i><b>4.2.5</b> Size Factors Slot: <code>sizeFactors</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-infrastructure.html"><a href="data-infrastructure.html#a-brief-recap-from-se-to-sce"><i class="fa fa-check"></i><b>4.3</b> A Brief Recap: From <code>se</code> to <code>sce</code></a></li>
<li class="chapter" data-level="4.4" data-path="data-infrastructure.html"><a href="data-infrastructure.html#the-reduceddims-slot"><i class="fa fa-check"></i><b>4.4</b> The <code>reducedDims</code> Slot</a></li>
<li class="chapter" data-level="4.5" data-path="data-infrastructure.html"><a href="data-infrastructure.html#one-more-thing-metadata-slot"><i class="fa fa-check"></i><b>4.5</b> One More Thing: <code>metadata</code> Slot</a></li>
<li class="chapter" data-level="4.6" data-path="data-infrastructure.html"><a href="data-infrastructure.html#about-spike-ins"><i class="fa fa-check"></i><b>4.6</b> About Spike-Ins</a></li>
<li class="chapter" data-level="4.7" data-path="data-infrastructure.html"><a href="data-infrastructure.html#working-with-singlecellexperiment"><i class="fa fa-check"></i><b>4.7</b> Working with <em>SingleCellExperiment</em></a></li>
<li class="chapter" data-level="4.8" data-path="data-infrastructure.html"><a href="data-infrastructure.html#the-centrality-of-singlecellexperiment"><i class="fa fa-check"></i><b>4.8</b> The Centrality of SingleCellExperiment</a></li>
<li class="chapter" data-level="4.9" data-path="data-infrastructure.html"><a href="data-infrastructure.html#multimodal-data-multiassayexperiment"><i class="fa fa-check"></i><b>4.9</b> Multimodal Data: <em>MultiAssayExperiment</em></a></li>
</ul></li>
<li class="part"><span><b>II Workflows</b></span></li>
<li class="chapter" data-level="5" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html"><i class="fa fa-check"></i><b>5</b> Analytical Workflow Overview</a><ul>
<li class="chapter" data-level="5.1" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#experimental-design"><i class="fa fa-check"></i><b>5.1</b> Experimental Design</a></li>
<li class="chapter" data-level="5.2" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#preprocessing"><i class="fa fa-check"></i><b>5.2</b> Preprocessing</a></li>
<li class="chapter" data-level="5.3" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#import-to-r"><i class="fa fa-check"></i><b>5.3</b> Import to R</a></li>
<li class="chapter" data-level="5.4" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#data-processing"><i class="fa fa-check"></i><b>5.4</b> Data Processing</a><ul>
<li class="chapter" data-level="5.4.1" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#quality-control-metrics"><i class="fa fa-check"></i><b>5.4.1</b> Quality Control Metrics</a></li>
<li class="chapter" data-level="5.4.2" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#normalizing-data"><i class="fa fa-check"></i><b>5.4.2</b> Normalizing Data</a></li>
<li class="chapter" data-level="5.4.3" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#feature-selection"><i class="fa fa-check"></i><b>5.4.3</b> Feature Selection</a></li>
<li class="chapter" data-level="5.4.4" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#imputation"><i class="fa fa-check"></i><b>5.4.4</b> Imputation</a></li>
<li class="chapter" data-level="5.4.5" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#dimensionality-reduction"><i class="fa fa-check"></i><b>5.4.5</b> Dimensionality Reduction</a></li>
<li class="chapter" data-level="5.4.6" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#integrating-datasets"><i class="fa fa-check"></i><b>5.4.6</b> Integrating Datasets</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#downstream-statistical-analyses"><i class="fa fa-check"></i><b>5.5</b> Downstream Statistical Analyses</a><ul>
<li class="chapter" data-level="5.5.1" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#clustering"><i class="fa fa-check"></i><b>5.5.1</b> Clustering</a></li>
<li class="chapter" data-level="5.5.2" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#differential-expression"><i class="fa fa-check"></i><b>5.5.2</b> Differential Expression</a></li>
<li class="chapter" data-level="5.5.3" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#trajectory-analysis"><i class="fa fa-check"></i><b>5.5.3</b> Trajectory Analysis</a></li>
<li class="chapter" data-level="5.5.4" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#annotation"><i class="fa fa-check"></i><b>5.5.4</b> Annotation</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#accessible-reproducible-analysis"><i class="fa fa-check"></i><b>5.6</b> Accessible &amp; Reproducible Analysis</a><ul>
<li class="chapter" data-level="5.6.1" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#interactive-data-visualization"><i class="fa fa-check"></i><b>5.6.1</b> Interactive Data Visualization</a></li>
<li class="chapter" data-level="5.6.2" data-path="analytical-workflow-overview.html"><a href="analytical-workflow-overview.html#report-generation"><i class="fa fa-check"></i><b>5.6.2</b> Report Generation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>6</b> Quick Start</a><ul>
<li class="chapter" data-level="6.1" data-path="quick-start.html"><a href="quick-start.html#code"><i class="fa fa-check"></i><b>6.1</b> Code</a></li>
<li class="chapter" data-level="6.2" data-path="quick-start.html"><a href="quick-start.html#visualizations"><i class="fa fa-check"></i><b>6.2</b> Visualizations</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html"><i class="fa fa-check"></i><b>7</b> A Basic Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#preprocessing-import-to-r"><i class="fa fa-check"></i><b>7.1</b> Preprocessing &amp; Import to R</a></li>
<li class="chapter" data-level="7.2" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#constructing-the-singlecellexperiment"><i class="fa fa-check"></i><b>7.2</b> Constructing the SingleCellExperiment</a><ul>
<li class="chapter" data-level="7.2.1" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#from-scratch"><i class="fa fa-check"></i><b>7.2.1</b> From Scratch</a></li>
<li class="chapter" data-level="7.2.2" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#from-publicly-available-data"><i class="fa fa-check"></i><b>7.2.2</b> From Publicly Available Data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#data-processing-1"><i class="fa fa-check"></i><b>7.3</b> Data Processing</a><ul>
<li class="chapter" data-level="7.3.1" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#quality-control-metrics-1"><i class="fa fa-check"></i><b>7.3.1</b> Quality Control Metrics</a></li>
<li class="chapter" data-level="7.3.2" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#normalizing-data-1"><i class="fa fa-check"></i><b>7.3.2</b> Normalizing Data</a></li>
<li class="chapter" data-level="7.3.3" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#feature-selection-1"><i class="fa fa-check"></i><b>7.3.3</b> Feature Selection</a></li>
<li class="chapter" data-level="7.3.4" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#dimensionality-reduction-1"><i class="fa fa-check"></i><b>7.3.4</b> Dimensionality Reduction</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#downstream-statistical-analyses-1"><i class="fa fa-check"></i><b>7.4</b> Downstream Statistical Analyses</a><ul>
<li class="chapter" data-level="7.4.1" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#clustering-1"><i class="fa fa-check"></i><b>7.4.1</b> Clustering</a></li>
<li class="chapter" data-level="7.4.2" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#differential-expression-1"><i class="fa fa-check"></i><b>7.4.2</b> Differential Expression</a></li>
<li class="chapter" data-level="7.4.3" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#annotation-1"><i class="fa fa-check"></i><b>7.4.3</b> Annotation</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#accessible-reproducible-analysis-1"><i class="fa fa-check"></i><b>7.5</b> Accessible &amp; Reproducible Analysis</a><ul>
<li class="chapter" data-level="7.5.1" data-path="a-basic-analysis.html"><a href="a-basic-analysis.html#interactive-data-visualization-1"><i class="fa fa-check"></i><b>7.5.1</b> Interactive Data Visualization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>8</b> Quality Control</a><ul>
<li class="chapter" data-level="8.1" data-path="quality-control.html"><a href="quality-control.html#motivation"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="quality-control.html"><a href="quality-control.html#introducing-the-dataset"><i class="fa fa-check"></i><b>8.2</b> Introducing the dataset</a></li>
<li class="chapter" data-level="8.3" data-path="quality-control.html"><a href="quality-control.html#choice-of-qc-metrics"><i class="fa fa-check"></i><b>8.3</b> Choice of QC metrics</a></li>
<li class="chapter" data-level="8.4" data-path="quality-control.html"><a href="quality-control.html#identifying-low-quality-cells"><i class="fa fa-check"></i><b>8.4</b> Identifying low-quality cells</a><ul>
<li class="chapter" data-level="8.4.1" data-path="quality-control.html"><a href="quality-control.html#with-fixed-thresholds"><i class="fa fa-check"></i><b>8.4.1</b> With fixed thresholds</a></li>
<li class="chapter" data-level="8.4.2" data-path="quality-control.html"><a href="quality-control.html#with-adaptive-thresholds"><i class="fa fa-check"></i><b>8.4.2</b> With adaptive thresholds</a></li>
<li class="chapter" data-level="8.4.3" data-path="quality-control.html"><a href="quality-control.html#considering-experimental-factors"><i class="fa fa-check"></i><b>8.4.3</b> Considering experimental factors</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="quality-control.html"><a href="quality-control.html#checking-diagnostic-plots"><i class="fa fa-check"></i><b>8.5</b> Checking diagnostic plots</a></li>
<li class="chapter" data-level="8.6" data-path="quality-control.html"><a href="quality-control.html#droplet-specific-procedures"><i class="fa fa-check"></i><b>8.6</b> Droplet-specific procedures</a><ul>
<li class="chapter" data-level="8.6.1" data-path="quality-control.html"><a href="quality-control.html#background"><i class="fa fa-check"></i><b>8.6.1</b> Background</a></li>
<li class="chapter" data-level="8.6.2" data-path="quality-control.html"><a href="quality-control.html#testing-for-empty-droplets"><i class="fa fa-check"></i><b>8.6.2</b> Testing for empty droplets</a></li>
<li class="chapter" data-level="8.6.3" data-path="quality-control.html"><a href="quality-control.html#examining-cell-calling-diagnostics"><i class="fa fa-check"></i><b>8.6.3</b> Examining cell-calling diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="quality-control.html"><a href="quality-control.html#assumptions-of-outlier-detection"><i class="fa fa-check"></i><b>8.7</b> Assumptions of outlier detection</a><ul>
<li class="chapter" data-level="8.7.1" data-path="quality-control.html"><a href="quality-control.html#overview"><i class="fa fa-check"></i><b>8.7.1</b> Overview</a></li>
<li class="chapter" data-level="8.7.2" data-path="quality-control.html"><a href="quality-control.html#checking-for-discarded-cell-types"><i class="fa fa-check"></i><b>8.7.2</b> Checking for discarded cell types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="normalization.html"><a href="normalization.html"><i class="fa fa-check"></i><b>9</b> Normalization</a><ul>
<li class="chapter" data-level="9.1" data-path="normalization.html"><a href="normalization.html#motivation-1"><i class="fa fa-check"></i><b>9.1</b> Motivation</a></li>
<li class="chapter" data-level="9.2" data-path="normalization.html"><a href="normalization.html#setting-up-the-data"><i class="fa fa-check"></i><b>9.2</b> Setting up the data</a></li>
<li class="chapter" data-level="9.3" data-path="normalization.html"><a href="normalization.html#library-size-normalization"><i class="fa fa-check"></i><b>9.3</b> Library size normalization</a></li>
<li class="chapter" data-level="9.4" data-path="normalization.html"><a href="normalization.html#normalization-by-deconvolution"><i class="fa fa-check"></i><b>9.4</b> Normalization by deconvolution</a></li>
<li class="chapter" data-level="9.5" data-path="normalization.html"><a href="normalization.html#normalization-by-spike-ins"><i class="fa fa-check"></i><b>9.5</b> Normalization by spike-ins</a><ul>
<li class="chapter" data-level="9.5.1" data-path="normalization.html"><a href="normalization.html#differences-in-total-rna-content"><i class="fa fa-check"></i><b>9.5.1</b> Differences in total RNA content</a></li>
<li class="chapter" data-level="9.5.2" data-path="normalization.html"><a href="normalization.html#differences-in-cell-damage"><i class="fa fa-check"></i><b>9.5.2</b> Differences in cell damage</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="normalization.html"><a href="normalization.html#transformation"><i class="fa fa-check"></i><b>9.6</b> Transformation</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="clustering-2.html"><a href="clustering-2.html"><i class="fa fa-check"></i><b>10</b> Clustering</a><ul>
<li class="chapter" data-level="10.1" data-path="clustering-2.html"><a href="clustering-2.html#loading-the-data"><i class="fa fa-check"></i><b>10.1</b> Loading the Data</a></li>
<li class="chapter" data-level="10.2" data-path="clustering-2.html"><a href="clustering-2.html#manual-clustering"><i class="fa fa-check"></i><b>10.2</b> Manual Clustering</a><ul>
<li class="chapter" data-level="10.2.1" data-path="clustering-2.html"><a href="clustering-2.html#varying-k"><i class="fa fa-check"></i><b>10.2.1</b> Varying <code>k</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="clustering-2.html"><a href="clustering-2.html#varying-clustering-algorithms"><i class="fa fa-check"></i><b>10.2.2</b> Varying Clustering Algorithms</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="clustering-2.html"><a href="clustering-2.html#automated-clustering"><i class="fa fa-check"></i><b>10.3</b> Automated Clustering</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html"><i class="fa fa-check"></i><b>11</b> Integrating Datasets</a><ul>
<li class="chapter" data-level="11.1" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#preprocessing-1"><i class="fa fa-check"></i><b>11.1</b> Preprocessing</a></li>
<li class="chapter" data-level="11.2" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#fast-mnn"><i class="fa fa-check"></i><b>11.2</b> Fast MNN</a></li>
<li class="chapter" data-level="11.3" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#harmony"><i class="fa fa-check"></i><b>11.3</b> Harmony</a></li>
<li class="chapter" data-level="11.4" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#advanced-mnn-workflow"><i class="fa fa-check"></i><b>11.4</b> Advanced MNN Workflow</a><ul>
<li class="chapter" data-level="11.4.1" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#dimensionality-reduction-2"><i class="fa fa-check"></i><b>11.4.1</b> Dimensionality Reduction</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#naive-method-without-correction"><i class="fa fa-check"></i><b>11.5</b> Naive Method Without Correction</a></li>
<li class="chapter" data-level="11.6" data-path="integrating-datasets-1.html"><a href="integrating-datasets-1.html#limma-batch-correction"><i class="fa fa-check"></i><b>11.6</b> Limma Batch Correction</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="differential-expression-2.html"><a href="differential-expression-2.html"><i class="fa fa-check"></i><b>12</b> Differential Expression</a></li>
<li class="chapter" data-level="13" data-path="trajectory-analysis-1.html"><a href="trajectory-analysis-1.html"><i class="fa fa-check"></i><b>13</b> Trajectory Analysis</a></li>
<li class="chapter" data-level="14" data-path="annotation-2.html"><a href="annotation-2.html"><i class="fa fa-check"></i><b>14</b> Annotation</a></li>
<li class="chapter" data-level="15" data-path="sharing-and-interactive-interfaces.html"><a href="sharing-and-interactive-interfaces.html"><i class="fa fa-check"></i><b>15</b> Sharing and Interactive Interfaces</a></li>
<li class="chapter" data-level="16" data-path="adaptations-for-large-scale-data.html"><a href="adaptations-for-large-scale-data.html"><i class="fa fa-check"></i><b>16</b> Adaptations for Large-scale Data</a><ul>
<li class="chapter" data-level="16.1" data-path="adaptations-for-large-scale-data.html"><a href="adaptations-for-large-scale-data.html#approximate-methods"><i class="fa fa-check"></i><b>16.1</b> Approximate Methods</a></li>
<li class="chapter" data-level="16.2" data-path="adaptations-for-large-scale-data.html"><a href="adaptations-for-large-scale-data.html#parallelization"><i class="fa fa-check"></i><b>16.2</b> Parallelization</a></li>
<li class="chapter" data-level="16.3" data-path="adaptations-for-large-scale-data.html"><a href="adaptations-for-large-scale-data.html#on-disk-data"><i class="fa fa-check"></i><b>16.3</b> On-Disk Data</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="data-import-and-export.html"><a href="data-import-and-export.html"><i class="fa fa-check"></i><b>17</b> Data Import and Export</a></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="18" data-path="about-the-data.html"><a href="about-the-data.html"><i class="fa fa-check"></i><b>18</b> About the Data</a><ul>
<li class="chapter" data-level="18.1" data-path="about-the-data.html"><a href="about-the-data.html#x-genomics-pbmc-data"><i class="fa fa-check"></i><b>18.1</b> 10X Genomics PBMC Data</a></li>
<li class="chapter" data-level="18.2" data-path="about-the-data.html"><a href="about-the-data.html#cellbench_data"><i class="fa fa-check"></i><b>18.2</b> Cellbench_data</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="about-the-contributors.html"><a href="about-the-contributors.html"><i class="fa fa-check"></i><b>19</b> About the Contributors</a><ul>
<li class="chapter" data-level="19.0.1" data-path="about-the-contributors.html"><a href="about-the-contributors.html#stephanie-hicks-phd"><i class="fa fa-check"></i><b>19.0.1</b> <em>Stephanie Hicks, PhD</em></a></li>
<li class="chapter" data-level="19.0.2" data-path="about-the-contributors.html"><a href="about-the-contributors.html#raphael-gottardo-phd"><i class="fa fa-check"></i><b>19.0.2</b> <em>Raphael Gottardo, PhD</em></a></li>
<li class="chapter" data-level="19.0.3" data-path="about-the-contributors.html"><a href="about-the-contributors.html#robert-amezquita-phd"><i class="fa fa-check"></i><b>19.0.3</b> <em>Robert Amezquita, PhD</em></a></li>
<li class="chapter" data-level="19.0.4" data-path="about-the-contributors.html"><a href="about-the-contributors.html#aaron-lun-phd"><i class="fa fa-check"></i><b>19.0.4</b> <em>Aaron Lun, PhD</em></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bioconductor.org" target="blank">Published by Bioconductor</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Orchestrating Single-Cell Analysis with Bioconductor</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-infrastructure" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data Infrastructure</h1>
<p>One of the advantages of using Bioconductor packages is that they utilize common data infrastructures which makes analyses interoperable across various packages. Furthermore, much engineering effort is put into making this infrastructure robust and scalable. Here, we describe the <em>SingleCellExperiment</em> object (or <code>sce</code> in shorthand) in detail to describe how it is constructed, utilized in downstream analysis, and how it stores various types of primary data and metadata.</p>
<div id="prerequisites" class="section level2">
<h2><span class="header-section-number">4.1</span> Prerequisites</h2>
<p>The Bioconductor package <em>SingleCellExperiment</em> provides the <em>SingleCellExperiment</em> class for usage. While the package is implicitly installed and loaded when using any package that depends on the <em>SingleCellExperiment</em> class, it can be explicitly installed (and loaded) as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&#39;SingleCellExperiment&#39;</span>)</code></pre>
<p>Additionally, we use some functions from the <code>scater</code> and <code>scran</code> packages, as well as the CRAN package <code>uwot</code> (which conveniently can also be installed through <code>BiocManager</code>). These functions will be accessed through the <code>&lt;package&gt;::&lt;function&gt;</code> convention as needed.</p>
<pre class="sourceCode r"><code class="sourceCode r">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="kw">c</span>(<span class="st">&#39;scater&#39;</span>, <span class="st">&#39;scran&#39;</span>, <span class="st">&#39;uwot&#39;</span>))</code></pre>
<p>For this session, all we will need loaded is the <em>SingleCellExperiment</em> package:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(SingleCellExperiment)</code></pre>
</div>
<div id="the-singlecellexperiment-class" class="section level2">
<h2><span class="header-section-number">4.2</span> The <em>SingleCellExperiment</em> Class</h2>
<div class="figure">
<img src="images/SingleCellExperiment.png" alt="Overview of the SingleCellExperiment class object" />
<p class="caption">Overview of the <em>SingleCellExperiment</em> class object</p>
</div>
<div id="primary-data-the-assays-slot" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Primary Data: The <code>assays</code> Slot</h3>
<p>The <em>SingleCellExperiment</em> (<code>sce</code>) object is the basis of single-cell analytical applications based in Bioconductor. The <code>sce</code> object is an <a href="https://adv-r.hadley.nz/s4.html">S4 object</a>, which in essence provides a more formalized approach towards construction and accession of data compared to other methods available in R. The utility of S4 comes from validity checks that ensure that safe data manipulation, and most important for our discussion, from its extensibility through <em>slots</em>.</p>
<p>If we imagine the <code>sce</code> object to be a ship, the <em>slots</em> of <code>sce</code> can be thought of as individual cargo boxes - each exists as a separate entity <em>within</em> the <code>sce</code> object. Furthermore, each slot contains data that arrives in its own format. To extend the metaphor, we can imagine that different variations of cargo boxes are required for fruits versus bricks. In the case of <code>sce</code>, certain slots expect numeric matrices, whereas others may expect data frames.</p>
<p>To construct a rudimentary <code>sce</code> object, all we need is a single slot:</p>
<ul>
<li><code>assays</code> slot: contains primary data such as counts in list, where each entry of the list is in a matrix format, where rows correspond to features (genes) and columns correspond to samples (cells) (<em>Figure 1A, blue box</em>)</li>
</ul>
<p>Let’s start simple by generating three cells worth of count data across ten genes.</p>
<pre class="sourceCode r"><code class="sourceCode r">counts_matrix &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cell_1 =</span> <span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), 
                    <span class="dt">cell_2 =</span> <span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), 
                    <span class="dt">cell_3 =</span> <span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">30</span>))
<span class="kw">rownames</span>(counts_matrix) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;gene_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
counts_matrix &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(counts_matrix) <span class="co"># must be a matrix object!</span></code></pre>
<p>From this, we can now construct our first <em>SingleCellExperiment</em> object, using the defined <em>constructor</em>, <code>SingleCellExperiment()</code>. Note that we provide our data as a <em>named</em> <em>list</em>, and each entry of the list is a <em>matrix</em>. Here, we name the <code>counts_matrix</code> entry as simply <code>counts</code> within the list.</p>
<pre class="sourceCode r"><code class="sourceCode r">sce &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays =</span> <span class="kw">list</span>(<span class="dt">counts =</span> counts_matrix))</code></pre>
<p>To inspect the object, we can simply type <code>sce</code> into the console to see some pertinent information, which will display an overview of the various slots available to us (which may or may not have any data).</p>
<pre class="sourceCode r"><code class="sourceCode r">sce</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 3 
## metadata(0):
## assays(1): counts
## rownames(10): gene_1 gene_2 ... gene_9 gene_10
## rowData names(0):
## colnames(3): cell_1 cell_2 cell_3
## colData names(0):
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<p>To access the count data we just supplied, we can do any one of the following:</p>
<ul>
<li><code>assay(sce, &quot;counts&quot;)</code> - this is the most general method, where we can supply the name of the assay as the second argument.</li>
<li><code>counts(sce)</code> - this is the same as the above, but <em>only</em> works for assays with the special name <code>&quot;counts&quot;</code>.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">counts</span>(sce)</code></pre>
<pre><code>##         cell_1 cell_2 cell_3
## gene_1      10      7     30
## gene_2      10      5     24
## gene_3      10     16     33
## gene_4      14     14     36
## gene_5      15     14     36
## gene_6       7     12     28
## gene_7      11      4     35
## gene_8       9      9     28
## gene_9      11     11     27
## gene_10      8     15     35</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## assay(sce, &quot;counts&quot;) ## same as above in this special case</code></pre>
</div>
<div id="extending-the-assays-slot" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Extending the <code>assays</code> Slot</h3>
<p>What makes the <code>assay</code> slot especially powerful is that it can hold <em>multiple</em> representations of the primary data. This is especially useful for storing a <em>normalized</em> version of the data. We can do just that as shown below, using the <code>scran</code> and <code>scater</code> packages to compute a log-count normalized representation of the initial primary data.</p>
<p>Note that here, we overwrite our previous <code>sce</code> upon reassigning the results to <code>sce</code> - this is because these functions <em>return</em> a <em>SingleCellExperiment</em> object. Some functions - especially those outside of single-cell oriented Bioconductor packages - do not, in which case you will need to append your results to the <code>sce</code> object (see below).</p>
<pre class="sourceCode r"><code class="sourceCode r">sce &lt;-<span class="st"> </span>scran<span class="op">::</span><span class="kw">computeSumFactors</span>(sce)
sce &lt;-<span class="st"> </span>scater<span class="op">::</span><span class="kw">normalize</span>(sce)</code></pre>
<p>Viewing the object again, we see that these functions added some new entries:</p>
<pre class="sourceCode r"><code class="sourceCode r">sce</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 3 
## metadata(1): log.exprs.offset
## assays(2): counts logcounts
## rownames(10): gene_1 gene_2 ... gene_9 gene_10
## rowData names(0):
## colnames(3): cell_1 cell_2 cell_3
## colData names(0):
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<p>Specifically, we see that the <code>assays</code> slot has grown to be comprised of two entries: <code>counts</code> (our initial data) and <code>logcounts</code> (the normalized data). Similar to <code>counts</code>, the <code>logcounts</code> name is a special name which lets us access it simply by typing <code>logcounts(sce)</code>, although the longhand version works just as well.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">logcounts</span>(sce)</code></pre>
<pre><code>##         cell_1 cell_2 cell_3
## gene_1    4.14   3.64   4.15
## gene_2    4.14   3.20   3.85
## gene_3    4.14   4.76   4.28
## gene_4    4.60   4.58   4.40
## gene_5    4.70   4.58   4.40
## gene_6    3.66   4.36   4.06
## gene_7    4.27   2.91   4.36
## gene_8    4.00   3.97   4.06
## gene_9    4.27   4.24   4.01
## gene_10   3.84   4.67   4.36</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## assay(sce, &quot;logcounts&quot;) ## same as above</code></pre>
<p>Notice that the data before had a severe discrepancy in counts between cells 1/2 versus 3, and that normalization has ameliorated this difference.</p>
<p>To look at all the available assays within <code>sce</code>, we can type:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">assays</span>(sce)</code></pre>
<pre><code>## List of length 2
## names(2): counts logcounts</code></pre>
<p>While the functions above demonstrate automatic addition of assays to our <code>sce</code> object, there may be cases where we want to perform our own calculations and save the result into the <code>assays</code> slot. In particular, this is important for using functions that do <em>not</em> return your <em>SingleCellExperiment</em> object.</p>
<p>Let’s append a new version of the data that has been offset by <code>+100</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">counts_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">assay</span>(sce, <span class="st">&quot;counts&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="dv">100</span>
<span class="kw">assay</span>(sce, <span class="st">&quot;counts_100&quot;</span>) &lt;-<span class="st"> </span>counts_<span class="dv">100</span> <span class="co"># assign a new entry to assays slot</span></code></pre>
<p>Then we can use the accessor <code>assays()</code> (notice this is plural!) to see all our entries into the <code>assay</code> slot that we have made so far. Note that to see the <em>names</em> of all the assays, we use the plural <code>assays()</code> accessor, and to retrieve a single assay entry (as a matrix) we use the singular <code>assay()</code> accessor, providing the name of the assay we wish to retrieve as above.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">assays</span>(sce)</code></pre>
<pre><code>## List of length 3
## names(3): counts logcounts counts_100</code></pre>
<p>These entries are also seen on the default view of <code>sce</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">sce</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 3 
## metadata(1): log.exprs.offset
## assays(3): counts logcounts counts_100
## rownames(10): gene_1 gene_2 ... gene_9 gene_10
## rowData names(0):
## colnames(3): cell_1 cell_2 cell_3
## colData names(0):
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<p>This sort of extension of the <code>assays</code> slot is represented graphically in <em>Figure 1B (dark blue box)</em>, showing the addition of the <code>logcounts</code> matrix into the <code>assays</code> slot.</p>
<p>In a similar manner, many of the slots of <code>sce</code> are extendable through assignment as shown above, thus allowing for myriad custom functionality as needed for interoperability with functions outside of single-cell oriented Bioconductor packages.</p>
</div>
<div id="column-metadata-coldata-slot" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Column (Meta)Data: <code>colData</code> Slot</h3>
<p>To further annotate our <code>sce</code> object, one of the first and most useful pieces of information is adding on metadata that describes the columns of our primary data, e.g. describing the samples or cells of our experiment. This data is entered into the <code>colData</code> slot:</p>
<ul>
<li><code>colData</code> slot: metadata that describes that samples (cells) provided as a <code>data.frame</code> or (<code>DataFrame</code> if appending), where rows correspond to cells, and columns correspond to the sample (cells) metadata features (e.g. id, batch, author, etc.) (<em>Figure 1A, orange box</em>).</li>
</ul>
<p>So, let’s come up with some metadata for the cells, starting with a batch variable, where cells 1 and 2 are in batch 1, and cell 3 is from batch 2.</p>
<pre class="sourceCode r"><code class="sourceCode r">cell_metadata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">batch =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">rownames</span>(cell_metadata) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;cell_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre>
<p>Now, we can take two approaches - either append the <code>cell_metadata</code> to our existing <code>sce</code>, or start from scratch via the <code>SingleCellExperiment()</code> constructor and provide it from the get go. We’ll start from scratch for now, but will also show how to append the data as well:</p>
<pre class="sourceCode r"><code class="sourceCode r">## From scratch:
sce &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays =</span> <span class="kw">list</span>(<span class="dt">counts =</span> counts_matrix),
                           <span class="dt">colData =</span> cell_metadata)

## Appending to existing object (requires DataFrame() coercion)
## colData(sce) &lt;- DataFrame(cell_metadata)</code></pre>
<p>Similar to <code>assays</code>, we can see our colData is now populated from the default view of <code>sce</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">sce</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 3 
## metadata(0):
## assays(1): counts
## rownames(10): gene_1 gene_2 ... gene_9 gene_10
## rowData names(0):
## colnames(3): cell_1 cell_2 cell_3
## colData names(1): batch
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<p>And furthermore access our column (meta)data with the accessor, <code>colData()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colData</span>(sce)</code></pre>
<pre><code>## DataFrame with 3 rows and 1 column
##            batch
##        &lt;numeric&gt;
## cell_1         1
## cell_2         1
## cell_3         2</code></pre>
<p>Finally, some packages automatically add to the <code>colData</code> slot, for example, the <code>scater</code> package features a function, <code>calculateQCMetrics()</code>, which appends a lot of quality control data. Here we show the first five columns of <code>colData(sce)</code> with the quality control metrics appended to it.</p>
<pre class="sourceCode r"><code class="sourceCode r">sce &lt;-<span class="st"> </span>scater<span class="op">::</span><span class="kw">calculateQCMetrics</span>(sce)
<span class="kw">colData</span>(sce)[, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre>
<pre><code>## DataFrame with 3 rows and 5 columns
##            batch is_cell_control total_features_by_counts
##        &lt;numeric&gt;       &lt;logical&gt;                &lt;integer&gt;
## cell_1         1           FALSE                       10
## cell_2         1           FALSE                       10
## cell_3         2           FALSE                       10
##        log10_total_features_by_counts total_counts
##                             &lt;numeric&gt;    &lt;integer&gt;
## cell_1               1.04139268515822          105
## cell_2               1.04139268515822          107
## cell_3               1.04139268515822          312</code></pre>
<div id="using-coldata-for-subsetting" class="section level4">
<h4><span class="header-section-number">4.2.3.1</span> Using <code>colData</code> for Subsetting</h4>
<p>A common operation with <code>colData</code> is its use in subsetting. One simple way to access <code>colData</code> is through the use of the <code>$</code> operator, which is a shortcut for accessing a variable within the <code>colData</code> slot:</p>
<pre class="sourceCode r"><code class="sourceCode r">sce<span class="op">$</span>batch</code></pre>
<pre><code>## [1] 1 1 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## colData(sce)$batch # same as above</code></pre>
<p>If we only wanted cells within batch 1, we could subset our sce object as follows (remember, we subset on the <em>columns</em> in this case because we are filtering by cells/samples here).</p>
<pre class="sourceCode r"><code class="sourceCode r">sce[, sce<span class="op">$</span>batch <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 2 
## metadata(0):
## assays(1): counts
## rownames(10): gene_1 gene_2 ... gene_9 gene_10
## rowData names(7): is_feature_control mean_counts ... total_counts
##   log10_total_counts
## colnames(2): cell_1 cell_2
## colData names(10): batch is_cell_control ...
##   pct_counts_in_top_200_features pct_counts_in_top_500_features
## reducedDimNames(0):
## spikeNames(0):</code></pre>
</div>
</div>
<div id="feature-metadata-rowdatarowranges" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Feature Metadata: <code>rowData</code>/<code>rowRanges</code></h3>
<p>Lastly, the rows also have their own metadata slot to store information that pertains to the features of the <code>sce</code> object:</p>
<ul>
<li><code>rowData</code> slot: contains data in a <code>data.frame</code> (<code>DataFrame</code>) format that describes aspects of the data corresponding to the rows of the primary data (<em>Figure 1A, green box</em>).</li>
</ul>
<p>Furthermore, there is a special slot which pertains to features with genomic coordinates:</p>
<ul>
<li><code>rowRanges</code> slot: contains data in a <code>GRangesList</code> (where each entry is a <code>GenomicRanges</code> format) that describes the chromosome, start, and end coordinates of the features (genes, genomic regions).</li>
</ul>
<p>Both of these can be accessed via their respective accessors, <code>rowRanges()</code> and <code>rowData()</code>. In our case, <code>rowRanges(sce)</code> produces an empty list:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rowRanges</span>(sce) <span class="co"># empty</span></code></pre>
<pre><code>## GRangesList object of length 10:
## $gene_1
## GRanges object with 0 ranges and 0 metadata columns:
##    seqnames    ranges strand
##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;
##   -------
##   seqinfo: no sequences
## 
## $gene_2
## GRanges object with 0 ranges and 0 metadata columns:
##    seqnames    ranges strand
##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;
##   -------
##   seqinfo: no sequences
## 
## $gene_3
## GRanges object with 0 ranges and 0 metadata columns:
##    seqnames    ranges strand
##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;
##   -------
##   seqinfo: no sequences
## 
## ...
## &lt;7 more elements&gt;</code></pre>
<p>However, our call to <code>calculateQCMetrics(sce)</code> in the prior section filled in the <code>rowData</code> slot of our <code>sce</code> object, as we can see below (only the first three columns are shown for brevity):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rowData</span>(sce)[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code></pre>
<pre><code>## DataFrame with 10 rows and 3 columns
##         is_feature_control      mean_counts log10_mean_counts
##                  &lt;logical&gt;        &lt;numeric&gt;         &lt;numeric&gt;
## gene_1               FALSE 15.6666666666667  1.22184874961636
## gene_2               FALSE               13  1.14612803567824
## gene_3               FALSE 19.6666666666667  1.31527043477859
## gene_4               FALSE 21.3333333333333  1.34895354798116
## gene_5               FALSE 21.6666666666667  1.35538765798657
## gene_6               FALSE 15.6666666666667  1.22184874961636
## gene_7               FALSE 16.6666666666667  1.24715461488113
## gene_8               FALSE 15.3333333333333  1.21307482530885
## gene_9               FALSE 16.3333333333333  1.23888208891514
## gene_10              FALSE 19.3333333333333   1.3082085802911</code></pre>
<p>In a similar fashion to the <code>colData</code> slot, such feature metadata could be provided at the onset when creating the <em>SingleCellExperiment</em> object, which we leave up to the reader as an exercise.</p>
<div id="subsetting-with-on-rows" class="section level4">
<h4><span class="header-section-number">4.2.4.1</span> Subsetting with on Rows</h4>
<p>To subset an <code>sce</code> object down at the feature/gene level, we can do a row subsetting operation similar to other R objects, by supplying either numeric indices or a vector of names:</p>
<pre class="sourceCode r"><code class="sourceCode r">sce[<span class="kw">c</span>(<span class="st">&quot;gene_1&quot;</span>, <span class="st">&quot;gene_4&quot;</span>), ]</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 2 3 
## metadata(0):
## assays(1): counts
## rownames(2): gene_1 gene_4
## rowData names(7): is_feature_control mean_counts ... total_counts
##   log10_total_counts
## colnames(3): cell_1 cell_2 cell_3
## colData names(10): batch is_cell_control ...
##   pct_counts_in_top_200_features pct_counts_in_top_500_features
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## sce[c(1, 4), ] # same as above in this case</code></pre>
</div>
</div>
<div id="size-factors-slot-sizefactors" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Size Factors Slot: <code>sizeFactors</code></h3>
<p>Briefly, we already encountered this via the <code>scran::computeSumFactors(sce)</code> call, which adds a <code>sizeFactors</code> slot:</p>
<ul>
<li><code>sizeFactors</code> slot: contains information in a numeric vector regarding the sample/cell normalization factors used to produce a normalize data representation (<em>Figure 1B, brown box</em>)</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">sce &lt;-<span class="st"> </span>scran<span class="op">::</span><span class="kw">computeSumFactors</span>(sce)
sce &lt;-<span class="st"> </span>scater<span class="op">::</span><span class="kw">normalize</span>(sce)
<span class="kw">sizeFactors</span>(sce)</code></pre>
<pre><code>## [1] 0.601 0.613 1.786</code></pre>
</div>
</div>
<div id="a-brief-recap-from-se-to-sce" class="section level2">
<h2><span class="header-section-number">4.3</span> A Brief Recap: From <code>se</code> to <code>sce</code></h2>
<p>So far, we have covered the <code>assays</code> (primary data), <code>colData</code> (sample metadata), <code>rowData</code>/<code>rowRanges</code> (feature metadata), and <code>sizeFactors</code> slots of <em>SingleCellExperiment</em>.</p>
<p>What is important to note is that the <em>SingleCellExperiment</em> class <em>derives</em> from the <code>SummarizedExperiment</code> (<code>se</code>) class, its predecessor, and in particular inherits the aforementioned slots. As such, much of the <code>SummarizedExperiment</code> functionality is retained in <em>SingleCellExperiment</em>. This allows existing methods that work with <code>SummarizedExperiment</code> to work similarly on <em>SingleCellExperiment</em> objects.</p>
<p>So what’s new about the <em>SingleCellExperiment</em> class then? For our discussion, the most important change is the addition of a new slot called <code>reducedDims</code>.</p>
</div>
<div id="the-reduceddims-slot" class="section level2">
<h2><span class="header-section-number">4.4</span> The <code>reducedDims</code> Slot</h2>
<p>The <code>reducedDims</code> slot is a new addition which is specially designed to store the reduced dimensionality representations of primary data, such as PCA, tSNE, UMAP, and others.</p>
<ul>
<li><code>reducedDims</code> slot: contains a list of numeric <code>matrix</code> entries which describe dimensionality reduced representations of the primary data, such that rows represent the columns of the primary data (aka the samples/cells), and columns represent the dimensions</li>
</ul>
<p>Most importantly, just like the <code>assays</code> slot, the <code>reducedDims</code> slot can hold a list of many entries. So, it can hold a PCA, TSNE, and UMAP representation of a given dataset all within the <code>reducedDims</code> slot.</p>
<p>In our example, we can calculate a PCA representation of our data as follows using the <code>scater</code> package function <code>runPCA()</code>. We see that the <code>sce</code> now shows a new <code>reducedDim</code> and that the accessor <code>reducedDim()</code> produces the results of running PCA on the normalized data from <code>logcounts(sce)</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">sce &lt;-<span class="st"> </span>scater<span class="op">::</span><span class="kw">runPCA</span>(sce)
<span class="kw">reducedDim</span>(sce, <span class="st">&quot;PCA&quot;</span>)</code></pre>
<pre><code>##          PC1    PC2      PC3
## cell_1 -1.46 -1.977 5.01e-15
## cell_2  2.83 -0.037 5.01e-15
## cell_3 -1.38  2.014 5.01e-15
## attr(,&quot;percentVar&quot;)
## [1] 6.01e-01 3.99e-01 3.77e-30</code></pre>
<p>From this, we can also calculate a tSNE representation using the <code>scater</code> package function <code>runTSNE()</code>, and see that it can be seen both in the default view of <code>sce</code> and via accession:</p>
<pre class="sourceCode r"><code class="sourceCode r">sce &lt;-<span class="st"> </span>scater<span class="op">::</span><span class="kw">runTSNE</span>(sce, <span class="dt">perplexity =</span> <span class="fl">0.1</span>)</code></pre>
<pre><code>## Perplexity should be lower than K!</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">reducedDim</span>(sce, <span class="st">&quot;TSNE&quot;</span>)</code></pre>
<pre><code>##         [,1]  [,2]
## cell_1  1432  5509
## cell_2  4056 -4002
## cell_3 -5489 -1507</code></pre>
<p>We can view the names of all our entries in the <code>reducedDims</code> slot via the accessor, <code>reducedDims()</code> (notice that this is plural, and thus not the same as <code>reducedDim()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">reducedDims</span>(sce)</code></pre>
<pre><code>## List of length 2
## names(2): PCA TSNE</code></pre>
<p>Now, say we have a different dimensionality reduction approach which has not yet been implemented with <em>SingleCellExperiment</em> objects in mind. For example, let’s say we want to try the <code>umap()</code> function as implemented in the <code>uwot</code> package (which is a much faster version of the default <code>umap</code> implementation currently in <code>scater</code>).</p>
<p>Similar to how we extended the <code>assays</code> slot with our own custom entry of <code>counts_100</code>, we can do similarly for the <code>reducedDims</code> slot:</p>
<pre class="sourceCode r"><code class="sourceCode r">u &lt;-<span class="st"> </span>uwot<span class="op">::</span><span class="kw">umap</span>(<span class="kw">t</span>(<span class="kw">logcounts</span>(sce)), <span class="dt">n_neighbors =</span> <span class="dv">2</span>)
<span class="kw">reducedDim</span>(sce, <span class="st">&quot;UMAP_uwot&quot;</span>) &lt;-<span class="st"> </span>u

<span class="kw">reducedDim</span>(sce, <span class="st">&quot;UMAP_uwot&quot;</span>)</code></pre>
<pre><code>##          [,1]    [,2]
## cell_1 -0.537  0.3821
## cell_2  0.666 -0.0445
## cell_3 -0.129 -0.3376
## attr(,&quot;scaled:center&quot;)
## [1] -25.29   8.05</code></pre>
<p>And we can also see its entry when we look at the <code>reducedDims()</code> accessor output:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">reducedDims</span>(sce)</code></pre>
<pre><code>## List of length 3
## names(3): PCA TSNE UMAP_uwot</code></pre>
</div>
<div id="one-more-thing-metadata-slot" class="section level2">
<h2><span class="header-section-number">4.5</span> One More Thing: <code>metadata</code> Slot</h2>
<p>Some analyses produce results that do not fit into the aforementioned slots. Thankfully, there is a slot just for this type of messy data, and in fact, can accommodate any type of data, so long as it is in a named list:</p>
<ul>
<li><code>metadata</code> slot: a named list of entries, where each entry in the list can be anything you want it to be</li>
</ul>
<p>For example, say we have some favorite genes, such as highly variable genes, we want to save inside of <code>sce</code> for use in our analysis at a later point. We can do this simply by appending to the metadata slot as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">my_genes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene_1&quot;</span>, <span class="st">&quot;gene_5&quot;</span>)
<span class="kw">metadata</span>(sce) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">favorite_genes =</span> my_genes)
<span class="kw">metadata</span>(sce)</code></pre>
<pre><code>## $favorite_genes
## [1] &quot;gene_1&quot; &quot;gene_5&quot;</code></pre>
<p>Similarly, we can append more information via the <code>$</code> operator:</p>
<pre class="sourceCode r"><code class="sourceCode r">your_genes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene_4&quot;</span>, <span class="st">&quot;gene_8&quot;</span>)
<span class="kw">metadata</span>(sce)<span class="op">$</span>your_genes &lt;-<span class="st"> </span>your_genes
<span class="kw">metadata</span>(sce)</code></pre>
<pre><code>## $favorite_genes
## [1] &quot;gene_1&quot; &quot;gene_5&quot;
## 
## $your_genes
## [1] &quot;gene_4&quot; &quot;gene_8&quot;</code></pre>
</div>
<div id="about-spike-ins" class="section level2">
<h2><span class="header-section-number">4.6</span> About Spike-Ins</h2>
<p>You might have noticed that the <code>sce</code> default view produces an entry with <code>spikeNames</code>. The <em>SingleCellExperiment</em> object contains some special considerations for experiments with spike-in (ERCC) controls. We leave this to the interested reader to learn more about in the <a href="https://bioconductor.org/packages/release/bioc/vignettes/SingleCellExperiment/inst/doc/intro.html"><em>SingleCellExperiment</em> introductory vignette</a>.</p>
</div>
<div id="working-with-singlecellexperiment" class="section level2">
<h2><span class="header-section-number">4.7</span> Working with <em>SingleCellExperiment</em></h2>
<p>In subsequent sections, we will show an example workflow that uses the <em>SingleCellExperiment</em> object as its base, and similar to our walkthrough of the <em>SingleCellExperiment</em> class above, continually appends new entries to save the results of the analysis. The <em>SingleCellExperiment</em> thus can serve as a record of analysis in this manner. This makes it especially useful for collaboration, as the object can be transferred and then visualized via graphical user interfaces such as <em>iSEE</em>.</p>
</div>
<div id="the-centrality-of-singlecellexperiment" class="section level2">
<h2><span class="header-section-number">4.8</span> The Centrality of SingleCellExperiment</h2>
<div class="figure">
<img src="images/SingleCellExperiment.png" alt="Graph network of package dependencies linking to the SingleCellExperiment package (class). Packages are filtered by biocView “singleCell”." />
<p class="caption">Graph network of package dependencies linking to the <em>SingleCellExperiment</em> package (class). Packages are filtered by biocView “singleCell”.</p>
</div>
<p>To emphasize its importance, here we show the centrality of the <em>SingleCellExperiment</em> class to the Bioc-verse single-cell related packages. It is this connection to <em>SingleCellExperiment</em> that makes many of these packages easily interoperable and modular over the span of an scRNA-seq analysis.</p>
</div>
<div id="multimodal-data-multiassayexperiment" class="section level2">
<h2><span class="header-section-number">4.9</span> Multimodal Data: <em>MultiAssayExperiment</em></h2>
<p>Recent advances in technology and protocols allow the simultaneous collection of DNA and RNA from the same cells, enabling single-cell multi-modal analysis. These data present new challenges in the complexity of statistical analyses, which are addressed in Bioconductor through the <em>MultiAssayExperiment</em> container. The <em>MultiAssayExperiment</em> class integrates all major Bioconductor experimental data containers, and any containers derived from those, including <em>SingleCellExperiment</em>. It provides harmonized data management for heterogeneous assays, including subsetting by genomic identifiers, genomic coordinates, or sample/cell attributes such as cell type. The user interface mimics that of <em>SingleCellExperiment</em>, with comparable actions working across all assays.</p>
<p>Multi-modal profiling is an emergent area of single-cell biology with many exciting technologies coming online, such as gene expression profiling in tandem with protein via CITE-seq/REAP-seq and adaptive repertoire sequencing. While we won’t cover multimodal data analysis further in this online book as of this writing, we anticipate infrastructure and statistical methodology advances in this area in the near future.</p>
<!-- \cite{Macaulay2016gtseq, Dey2015-eh, Stoeckius2017-se} -->

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="beyond-r-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analytical-workflow-overview.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Bioconductor/OrchestratingSingleCellAnalysis/P1_04.data-infrastructure.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["OSCA.pdf", "OSCA.epub"],
"toc": {
"collapse": "subsection"
},
"bookdown::epub_book": "default",
"cover": "images/cover.png"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
